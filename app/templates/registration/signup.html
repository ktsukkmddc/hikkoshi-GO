{% extends 'base_plain.html' %}
{% load static %}

{% block title %}新規アカウント登録 | 引越しGO{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/signup.css' %}">
{% endblock %}

{% block content %}
<div class="signup-wrapper">
  <h2>新規アカウント登録</h2>

  <form method="post">
    {% csrf_token %}

    {% if invite_code %}
      <input type="hidden" name="invite_code" value="{{ invite_code }}">
    {% endif %}

    {% if form.non_field_errors %}
      <div class="error" style="color:red; font-size:13px; margin-bottom:10px;">
        {{ form.non_field_errors|striptags }}
      </div>
    {% endif %}

    <div class="form-group">
      <label for="id_full_name">名前</label>
      {{ form.full_name }}
      {% if form.name.errors %}
        <div class="error" style="color:red; font-size:13px;">
          {{ form.name.errors|striptags }}
        </div>
    {% endif %}
    </div>

    <div class="form-group">
      <label for="id_email">メールアドレス</label>
      {{ form.email }}
      {% if form.email.errors %}
        <div class="error" style="color:red; font-size:13px;">
          {{ form.email.errors|striptags }}
        </div>
      {% endif %}
    </div>

    <div class="form-group password-field">
      <label for="id_password1">パスワード</label> 
      {{ form.password1 }}
      {% if form.password1.errors %}
        <div class="error" style="color:red; font-size:13px;">
          {{ form.password1.errors|striptags }}
        </div>
      {% endif %}
    </div>

    <div class="form-group">
      <label for="id_password2">パスワード再入力</label>
      {{ form.password2 }}
      {% if form.password2.errors %}
        <div class="error" style="color:red; font-size:13px;">
          {{ form.password2.errors|striptags }}
        </div>
      {% endif %}
    </div>

    {% include 'partials/password_rules.html' %}

    <button type="submit" class="btn">登録</button>
  </form>

  <p class="login-link">
      <a href="{% url 'login' %}">すでにアカウントをお持ちの方はこちら</a>
    </p>
</div>

<script>
  const rulesBtn = document.getElementById('password-rules-btn');
  const rulesBox = document.getElementById('password-rules');

  rulesBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // クリックイベントの伝播を防ぐ
    rulesBox.style.display = (rulesBox.style.display === 'block') ? 'none' : 'block';
    if (rulesBox.style.display === 'block') {
      rulesBox.classList.add('fade-in');
    } else {
      rulesBox.classList.remove('fade-in');
    }
    });

    // 画面のどこかをクリックしたら閉じる
    document.addEventListener('click', (e) => {
      if (rulesBox.style.display === 'block' && !rulesBox.contains(e.target) && e.target !== rulesBtn) {
        rulesBox.style.display = 'none';
      }
    });
  </script>
{% endblock %}